# 1. 文件系统虚拟化

- 文件是操作系统进行存储时使用最多的抽象之一，每个文件实际上是一个有名字的字符序列，也可以把文件叫做虚拟磁盘，我们实际操作时都是在操作文件而不是直接操作硬盘中的数据。序列内容为文件数据，而序列长度、修改时间等属性特征信息被称为文件元数据

- 文件系统就是管理文件数据与元数据的系统。提供文件抽象并实现文件访问所需要的接口。考虑到存储空间太大，文件以数据块为单位进行访问，一个块一般4KB.

- 当应用程序向访问或写入一些数据到存储设备上时，它会采用Linux系统提供的open、write、read等系统调用；在处理系统调用时，内核会调用虚拟文件系统（VFS）来处理文件请求，虚拟文件系统负责管理具体的文件系统如inode文件系统，FAT32文件系统等

# 2. 什么是硬链接与符号连接？

硬链接：

一个文件的额外引用。每个文件都有一个inode数据结构来存储文件的元数据，比如文件权限、所有者、大小等。每个文件都有一个或多个文件名（硬链接），它们指向相应的inode。

特点：

- 不能跨文件系统。

- 不能引用目录。

- 删除一个文件的所有硬链接会导致文件被删除。当一个文件的最后一个硬链接被删除时，文件系统将释放该文件的inode以及占用的存储空间。

- 硬链接不影响原始文件的访问。所有硬链接都指向相同的inode，因此访问任何一个硬链接实际上是访问原始文件

符号链接（软）：

是一种特殊的文件，它包含指向另一个文件或目录的路径。与硬链接直接关联到inode不同，符号链接通过路径名来引用目标文件。当用户或应用程序访问符号链接时，文件系统会自动将其重定向到目标路径。

特点：

- 符号链接可以跨文件系统。由于符号链接通过路径名引用目标文件，它可以链接到其他文件系统中的文件或目录。

- 符号链接可以引用目录。这使得符号链接在文件系统组织和目录结构管理中非常有用

- 删除符号链接不会影响目标文件。当删除一个符号链接时，只有链接本身被删除，而目标文件保持不变。

- 符号链接可能引起死链接。如果目标文件被删除或移动，符号链接将指向一个不存在的路径，导致死链接。

# 3. 讲一讲inode文件系统结构？

Inode（索引节点）是文件系统中的一个数据结构，用于存储文件或目录的元数据，例如文件大小、时间戳、权限、所有者等。Inode还包含了指向实际文件数据块的指针，这些数据快存储了文件的内容。

在UNIX和类UNIX文件系统中，每个文件或目录都有一个唯一的Inode号，用于唯一表示文件系统中的对象。文件名只是一个用户友好的引用，实际上是指向Inode号的指针，这种设计允许文件系统以更高效的方式管理和访问文件，同时提供了硬链接等高级功能。以下是Inode文件系统结构的几个关键组成部分：

- Inode表：Inode表是文件系统中一个预先分配的区域，用于存储Inode数据结构。每个Inode在Inode表中占用固定大小的空间，通常为128字节或256字节。文件系统在格式化时会预先分配一定数量的Inode，这些Inode数量决定了文件系统能够容纳的最大文件和目录数量。

- 数据块：数据块是文件系统中用于存储文件内容的基本单位。数据块的大小通常为4KB、8KB或更大。每个Inode包含了指向文件数据块的指针，这些指针可以直接指向数据块（直接块指针），也可以指向间接块、二次间接块或三次

- 目录项：目录项是文件系统中表示目录结构的数据结构。每个目录项包含一个文件名和一个对应的Inode号。目录项存储在目录文件的数据块中，通过Inode号可以找到目录项所指向的文件或子目录的Inode和数据块。

- 超级块：是文件系统中存储元数据的区域。包含了文件系统的基本信息，如文件系统类型、大小、块大小、Inode数量等。操作系统在挂载文件系统时会读取超级块，以确定文件系统的参数和状态。

# 4. 讲一讲FAT文件系统与UNIX文件系统

FAT：

Windows主要的文件系统。有多个版本FAT12、FAT16、FAT32。核心是文件分配表，记录文件数据块使用情况的表格

- 结构简单：易于实现和维护。通过链表的形式管理数据块，随机访问能力较差

- 跨平台兼容：普及程度高。

- 局限性：文件权限管理、文件大小限制和磁盘空间利用率等方面存在一定的局限性。如FAT32不支持超过4GB的单个文件。没有类似UNIX文件系统中的文件权限和所有权管理功能。

UNIX：

通常指在UNIX和类UNIX操作系统中使用的一系列文件系统，提升了随机访问的能力。并且支持链接。

特点：

- Inode结构：使用Inode来存储文件元数据

- 权限管理：支持详细的文件权限和所有权管理，允许对文件和目录进行读、写和执行权限的控制

- 硬链接和符号链接：UNIX文件系统支持硬链接和符号链接，可以用于创建文件和目录的引用，实现更灵活的文件系统组织和管理

- 日志功能：有助于提高文件系统的数据一致性和恢复能力

在实际应用中，这两种文件系统有各自的优势和适用场景：

FAT:

- 可移动存储设备

- 嵌入式系统

UNIX:

- UNIX和类UNIX操作系统中。

- 服务器和高性能计算。

# 5. 文件传输中断后如何续传，讲一讲Rsync算法

当文件传输过程中遇到中断，如网络故障或其他原因，需要一种方法来继续传输，而不是从头开始。续传功能可以有效地减少重复传输的数据量，从而提高传输效率。Rsync算法是一种用于文件同步和增量备份的高效算法，可以实现文件传输的续传功能。

Rsync算法基于滚动哈希（rolling hash）和数据块签名的方法来实现文件同步。

1. 将目标文件分割成固定大小或可变大小的数据块。对于每个数据块，计算两个哈希值：一个弱哈希值（如Adler-32校验和）和一个强哈希值（如MD5或SHA-1散列）。

2. 将这些哈希值（也成为数据块签名）发送到接收方。接收方在本地查找与目标文件相同的文件，通常是一个旧版本或部分传输的文件。

3. 接收方将本地文件划分为与发送方相同大小的数据块，并计算每个数据块的弱哈希值。

4. 接收方使用滚动哈希方法，在本地文件中寻找与发送方数据块相匹配的哈希值。同通过比较弱哈希值，接收方可以快速找到潜在的匹配数据块。为了避免误报。接收方还会比较强哈希值来确认数据块是否真正匹配、

5. 接收方将匹配的数据块信息（如数据块索引和偏移量）发送回发送方。

6. 发送方根据接收方返回的匹配信息，仅发送目标文件中未匹配的数据块，从而实现增量更新和续传功能。

除妖又是：可以在不传输整个文件的情况下检测和同步文件的差异。这种方法在大文件、低带宽和不稳定网络连接的场景中非常高效。不过Rsync算法本身并不负责文件传输，而是需要与其他文件传输协议（ssh、ftp）结合使用。
